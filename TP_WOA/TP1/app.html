<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Untitled Document</title>

</head>

<body style="font-size:10em">

    <span id="heure"></span><span>:</span><span id="minute"></span><span>:</span><span id="seconde"></span>
    <button id="plusHour">+1H</button>
    <button id="subHour">-1H</button>

    <script>
        var Observer = function () {
            this.update = function (message) {
                throw 'NotSupportedException';
            }
        };

        var Subject = function () {
            var observers = [];
            this.notify = function (message) {
                for (observerKey in observers) {
                    var observer = observers[observerKey];
                    observer.update(message);
                }
            }
            this.attach = function (observer) {
                observers.unshift(observer);
            }
        };

        var Vue = function (model) {
            Observer.call(this);
            Subject.call(this);
            this.model = model;
            this.plusHour = function () {
                this.notify('plusHour');
            };

            this.subHour = function () {
                this.notify('subHour');
            };

            window.document.getElementById('plusHour').addEventListener('click', this.plusHour.bind(this));
            window.document.getElementById('subHour').addEventListener('click', this.subHour.bind(this));




            this.formatNumber = function (val) {
                retour = val.toString();
                if (val < 10) {
                    retour = '0' + retour;
                }
                return retour;
            }
            this.update = function (message) {
                window.document.getElementById('seconde').innerHTML = this.formatNumber(model.seconde);
                window.document.getElementById('minute').innerHTML = this.formatNumber(model.minute);
                window.document.getElementById('heure').innerHTML = this.formatNumber(model.heure);
            }
        }

        Vue.prototype = Object.create(Observer.prototype);
        Vue.prototype = Object.create(Subject.prototype);

        var Model = function () {
            Subject.call(this);
            this.data = {};
            this.seconde = 0;
            this.minute = 0;
            this.heure = 0;

            function iteration() {
                this.seconde = this.seconde + 1;
                this.businessRule();
                this.notify();
            };

            this.addHour = function () {
                this.heure++;
                this.businessRule();
                this.notify('plusHour');
            };

            this.subHour = function () {
                this.heure--;
                this.businessRule();
                this.notify('subHour');
            };

            this.businessRule = function () {
                    if (this.seconde >= 60) {
                        this.minute++;
                        this.seconde -= 60;
                    }

                    if (this.minute >= 60) {
                        this.heure++;
                        this.minute -= 60;
                    }

                    if (this.heure >= 24) {
                        this.heure -= 24;
                    }

                }
                //standard context of callbak function used by setInterval is Window
            setInterval(iteration.bind(this), 1000);
        };

        var Controler = function () {
            Observer.call(this);
            this.update = function (message) {
                console.log(message);
                switch (message) {
                case 'plusHour':
                    model.addHour();
                    break;
                case 'subHour':
                    model.subHour();
                    break;
                }
            }

        };

        Controler.prototype = Object.create(Observer.prototype);

        Model.prototype = Object.create(Subject.prototype);

        var model = new Model();
        var vue = new Vue(model);
        var controler = new Controler(model);
        model.attach(vue);
        vue.attach(controler);
    </script>

</body>

</html>
